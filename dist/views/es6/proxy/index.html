<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue3 å®ç° v-model åŸç† | æŠ€åŒ </title>
    <meta name="description" content="å‰ç«¯çŸ¥è¯†æ·±å…¥å­¦ä¹ ">
    
    
    <link rel="preload" href="/xuege-learning/dist/assets/css/0.styles.2ac2341d.css" as="style"><link rel="preload" href="/xuege-learning/dist/assets/js/app.00484c13.js" as="script"><link rel="preload" href="/xuege-learning/dist/assets/js/2.a1730132.js" as="script"><link rel="preload" href="/xuege-learning/dist/assets/js/8.b97acee4.js" as="script"><link rel="prefetch" href="/xuege-learning/dist/assets/js/10.44e6a869.js"><link rel="prefetch" href="/xuege-learning/dist/assets/js/11.87007918.js"><link rel="prefetch" href="/xuege-learning/dist/assets/js/12.94e9130c.js"><link rel="prefetch" href="/xuege-learning/dist/assets/js/13.ba08e89f.js"><link rel="prefetch" href="/xuege-learning/dist/assets/js/14.cd9b649f.js"><link rel="prefetch" href="/xuege-learning/dist/assets/js/3.13006118.js"><link rel="prefetch" href="/xuege-learning/dist/assets/js/4.a3c3189d.js"><link rel="prefetch" href="/xuege-learning/dist/assets/js/5.e6cec025.js"><link rel="prefetch" href="/xuege-learning/dist/assets/js/6.55716d2e.js"><link rel="prefetch" href="/xuege-learning/dist/assets/js/7.84565306.js"><link rel="prefetch" href="/xuege-learning/dist/assets/js/9.76c7c64c.js">
    <link rel="stylesheet" href="/xuege-learning/dist/assets/css/0.styles.2ac2341d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/xuege-learning/dist/" class="home-link router-link-active"><!----> <span class="site-name">æŠ€åŒ </span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/xuege-learning/dist/" class="nav-link">Home</a></div><div class="nav-item"><a href="/xuege-learning/dist/guide/" class="nav-link">Guide</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xuege-learning/dist/language/chinese.html" class="nav-link">Chinese</a></li><li class="dropdown-item"><!----> <a href="/xuege-learning/dist/language/english.html" class="nav-link">English</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/luoxue-victor/xuege-learning" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/xuege-learning/dist/" class="nav-link">Home</a></div><div class="nav-item"><a href="/xuege-learning/dist/guide/" class="nav-link">Guide</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xuege-learning/dist/language/chinese.html" class="nav-link">Chinese</a></li><li class="dropdown-item"><!----> <a href="/xuege-learning/dist/language/english.html" class="nav-link">English</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/luoxue-victor/xuege-learning" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>vue3 å®ç° v-model åŸç†</span> <!----></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue3-å®ç°-v-model-åŸç†"><a href="#vue3-å®ç°-v-model-åŸç†" aria-hidden="true" class="header-anchor">#</a> vue3 å®ç° v-model åŸç†</h1> <blockquote><p>vue3 æºç æ­£å¼æ”¾å‡ºæ¥äº†ï¼Œæƒ³å¿…å¤§å®¶ä¹Ÿéƒ½å¼€å§‹äº‰å…ˆæåçš„å­¦ä¹  vue3 çš„çŸ¥è¯†äº†ã€‚ç”±äº vue3 å·²ç»ä¸å†æ”¯æŒ v-model äº†ï¼Œè€Œä½¿ç”¨ .sync æ¥ä»£æ›¿ï¼Œä½†æ˜¯ä¸ºäº†è¿™ç¯‡æ–‡ç« å¯ä»¥å¸®åŠ©å¤§å®¶å¿«é€Ÿäº†è§£ vue çš„åŒå‘ç»‘å®šå®ç°åŸç†ï¼Œéƒ¨åˆ†ä½¿ç”¨äº† vue2.x v-model çš„å®ç°åŸç†</p></blockquote> <p>proxy çš„åŸºç¡€çŸ¥è¯†ï¼Œç›¸ä¿¡å¤§å®¶å·²ç»éƒ½å¾ˆäº†è§£äº†ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥å›é¡¾ä¸€ä¸‹å§</p> <h5 id="proxy-æ˜¯å¯¹ä¸€ä¸ªå¯¹è±¡çš„ä»£ç†ï¼Œå¹¶è¿”å›ä¸€ä¸ªå·²ä»£ç†çš„å¯¹è±¡ï¼Œå·²ä»£ç†çš„å¯¹è±¡å¦‚æœå‘ç”Ÿä»»ä½•-set-è·Ÿ-get-çš„æ–¹æ³•éƒ½å¯ä»¥è¢«æ•è·åˆ°ï¼Œæˆ‘ä»¬å†™ä¸€ä¸ªç®€å•çš„-ğŸŒ°"><a href="#proxy-æ˜¯å¯¹ä¸€ä¸ªå¯¹è±¡çš„ä»£ç†ï¼Œå¹¶è¿”å›ä¸€ä¸ªå·²ä»£ç†çš„å¯¹è±¡ï¼Œå·²ä»£ç†çš„å¯¹è±¡å¦‚æœå‘ç”Ÿä»»ä½•-set-è·Ÿ-get-çš„æ–¹æ³•éƒ½å¯ä»¥è¢«æ•è·åˆ°ï¼Œæˆ‘ä»¬å†™ä¸€ä¸ªç®€å•çš„-ğŸŒ°" aria-hidden="true" class="header-anchor">#</a> proxy æ˜¯å¯¹ä¸€ä¸ªå¯¹è±¡çš„ä»£ç†ï¼Œå¹¶è¿”å›ä¸€ä¸ªå·²ä»£ç†çš„å¯¹è±¡ï¼Œå·²ä»£ç†çš„å¯¹è±¡å¦‚æœå‘ç”Ÿä»»ä½• set è·Ÿ get çš„æ–¹æ³•éƒ½å¯ä»¥è¢«æ•è·åˆ°ï¼Œæˆ‘ä»¬å†™ä¸€ä¸ªç®€å•çš„ ğŸŒ°</h5> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> handers <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å½“å¯¹ observed.a è¿›è¡Œå–å€¼æ—¶ä¼šè§¦å‘</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å½“å¯¹ observed.a è¿›è¡Œèµ‹å€¼æ—¶ä¼šè§¦å‘</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// è¿˜æœ‰ä¸€äº›é¢å¤–çš„å‚æ•°å¦‚ has ç­‰ï¼Œè¿™é‡Œç”¨ä¸åˆ°ï¼Œå°±ä¸å¤šè¯´äº†</span>
  <span class="token operator">...</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> observed <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> handers<span class="token punctuation">)</span>
</code></pre></div><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¯¹ target å¯¹è±¡è®¾ç½®äº†ä¸€å±‚ä»£ç†ï¼Œå½“æˆ‘ä»¬å¯¹ target è¿›è¡Œå–èµ‹å€¼æ“ä½œçš„æ—¶å€™å°±å¯ä»¥æ¥å¯ä»¥æˆªè·åˆ°å®ƒçš„è¡Œä¸ºäº†ï¼Œä½†æ˜¯å¦‚æœä½ ä»¥ä¸ºå°±åªæœ‰è¿™ä¹ˆç®€å•ä½ å°±é”™äº†ã€‚</p> <p>æˆ‘ä»¬æŠŠ target æ”¹å†™æˆå¤šå±‚åµŒå¥—</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    b<span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token operator">...</span>

<span class="token keyword">const</span> observed <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> handers<span class="token punctuation">)</span>
</code></pre></div><h5 id="æˆ‘ä»¬å†è·å–-observed-a-b-2-çš„æ—¶å€™ï¼Œget-æ–¹æ³•å–åˆ°çš„æ˜¯-a-çš„å€¼-b-1-è€Œ-set-å¹¶ä¸ä¼šè§¦å‘ã€‚è¿™ä¹Ÿè¯´æ˜äº†-proxy-åªèƒ½ä»£ç†ä¸€å±‚å¯¹è±¡ï¼Œä¸èƒ½æ·±å±‚ä»£ç†ï¼"><a href="#æˆ‘ä»¬å†è·å–-observed-a-b-2-çš„æ—¶å€™ï¼Œget-æ–¹æ³•å–åˆ°çš„æ˜¯-a-çš„å€¼-b-1-è€Œ-set-å¹¶ä¸ä¼šè§¦å‘ã€‚è¿™ä¹Ÿè¯´æ˜äº†-proxy-åªèƒ½ä»£ç†ä¸€å±‚å¯¹è±¡ï¼Œä¸èƒ½æ·±å±‚ä»£ç†ï¼" aria-hidden="true" class="header-anchor">#</a> æˆ‘ä»¬å†è·å– observed.a.b = 2 çš„æ—¶å€™ï¼Œget æ–¹æ³•å–åˆ°çš„æ˜¯ a çš„å€¼ { b: 1 }, è€Œ set å¹¶ä¸ä¼šè§¦å‘ã€‚è¿™ä¹Ÿè¯´æ˜äº† proxy åªèƒ½ä»£ç†ä¸€å±‚å¯¹è±¡ï¼Œä¸èƒ½æ·±å±‚ä»£ç†ï¼</h5> <p>é‚£ä¹ˆæˆ‘ä»¬éœ€è¦ç›‘å¬åˆ°åµŒå¥—çš„å¯¹è±¡æ€ä¹ˆåŠï¼Ÿ</p> <p>å…¶å®è¿™ä¸ªä¹Ÿä¸éš¾ï¼Œå°±æ˜¯åœ¨ get çš„æ—¶å€™åˆ¤æ–­ä¸€ä¸‹å¾—åˆ°çš„å€¼æ˜¯ä¸æ˜¯å¯¹è±¡ï¼Œå¦‚æœæ˜¯å¯¹è±¡çš„è¯å°± åœ¨å¯¹å®ƒä»£ç†ä¸€å±‚ï¼Œç›´åˆ°æœ€åä¸€å±‚ï¼Œå…¨éƒ¨ä»£ç†å®Œä¸ºæ­¢ï¼Œè¿™é‡Œå°±éœ€è¦ä¸€ä¸ªé€’å½’å‡½æ•°</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    b<span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> handers <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> res <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> observed <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> handers<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¯¹ç›®æ ‡å‡½æ•°å†…éƒ¨çš„æ‰€æœ‰å±æ€§è¿›è¡Œæ·±å±‚ç›‘å¬äº†ï¼Œä½†æ˜¯è¿™æ ·è¿˜æ˜¯ä¸å¤Ÿï¼Œå› ä¸ºæˆ‘ä»¬æ¯æ¬¡å–å€¼çš„æ—¶å€™éƒ½ä¼šè®¾ç½®ä»£ç†è¿™æ ·ä¼šå¯¼è‡´ä»£ç æ— é™å¾ªç¯-&gt;æ­»å¾ªç¯ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åšä¸€å±‚åˆ¤æ–­ï¼Œå¦‚æœå·²ç»è®¾ç½®äº†ä»£ç†çš„æˆ–è¿™å·²ç»æ˜¯ä»£ç†çš„å¯¹è±¡å°±ä¸éœ€è¦åœ¨æ­¤è®¾ç½®ä»£ç†äº†ã€‚åˆå› ä¸ºæˆ‘ä»¬è¦å‚¨å­˜å¯¹è±¡çš„æ˜ å°„ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨mapå‡½æ•°ã€‚ä¸‹é¢æ˜¯reactiveå®Œæ•´çš„ä»£ç ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> rawToReactive<span class="token punctuation">:</span> WeakMap<span class="token operator">&lt;</span>any<span class="token punctuation">,</span> any<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> reactiveToRaw<span class="token punctuation">:</span> WeakMap<span class="token operator">&lt;</span>any<span class="token punctuation">,</span> any<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å·²ç»æœ‰ä»£ç†</span>
  <span class="token keyword">let</span> observed <span class="token operator">=</span> rawToReactive<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>observed <span class="token operator">!==</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> observed<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// è¿™ä¸ªæ•°æ®å·²ç»æ˜¯ä»£ç†</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>reactiveToRaw<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> data<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> handler <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">:</span> any<span class="token punctuation">,</span> key<span class="token punctuation">:</span> string<span class="token punctuation">,</span> receiver<span class="token punctuation">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> res <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">set</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">:</span> any<span class="token punctuation">,</span> key<span class="token punctuation">:</span> string<span class="token punctuation">,</span> value<span class="token punctuation">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å°†æ–°å€¼èµ‹å€¼</span>
      target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token comment">// é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…è§¦å‘æ›´æ–°</span>
      <span class="token function">trigger</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// ä¸¥æ ¼æ¨¡å¼ä¸‹éœ€è¦è®¾ç½®è¿”å›å€¼ï¼Œå¦åˆ™ä¼šæŠ¥é”™</span>
      <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// è¿”å›ä»£ç†ç›‘å¬å¯¹è±¡</span>
  observed <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> handler <span class="token keyword">as</span> any<span class="token punctuation">)</span><span class="token punctuation">;</span>
  rawToReactive<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> observed<span class="token punctuation">)</span><span class="token punctuation">;</span>
  reactiveToRaw<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>observed<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> observed<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="å®šä¹‰watcher-ç”¨æ¥ä½œä¸º-compile-è·Ÿ-reactive-çš„æ¡¥æ¢ï¼Œ-è·Ÿ-vue3-çš„å®ç°å¯èƒ½ä¸ä¸€æ ·"><a href="#å®šä¹‰watcher-ç”¨æ¥ä½œä¸º-compile-è·Ÿ-reactive-çš„æ¡¥æ¢ï¼Œ-è·Ÿ-vue3-çš„å®ç°å¯èƒ½ä¸ä¸€æ ·" aria-hidden="true" class="header-anchor">#</a> å®šä¹‰watcher ç”¨æ¥ä½œä¸º compile è·Ÿ reactive çš„æ¡¥æ¢ï¼Œ è·Ÿ vue3 çš„å®ç°å¯èƒ½ä¸ä¸€æ ·</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// æ”¶é›†watcherä¾èµ–</span>
<span class="token keyword">const</span> Dep<span class="token punctuation">:</span> Dep <span class="token operator">=</span> <span class="token punctuation">{</span>
  deps<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">watcher<span class="token punctuation">:</span> Watcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>deps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// observerè·Ÿcompileçš„æ¡¥æ¢ï¼Œåœ¨ç¼–è¯‘æ—¶æ·»åŠ watcherï¼Œåœ¨æ•°æ®æ›´æ–°æ—¶è§¦å‘updateæ›´æ–°è§†å›¾</span>
<span class="token keyword">function</span> <span class="token function">_watcher</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">:</span> any<span class="token punctuation">,</span> attr<span class="token punctuation">:</span> string<span class="token punctuation">,</span> data<span class="token punctuation">:</span> any<span class="token punctuation">,</span> key<span class="token punctuation">:</span> string</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Watcher <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    node<span class="token punctuation">,</span>
    attr<span class="token punctuation">,</span>
    data<span class="token punctuation">,</span>
    key<span class="token punctuation">,</span>
    <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// é€å±‚å–å€¼</span>
      <span class="token keyword">const</span> mutationKeys <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>key<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>mutationKeys<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> d<span class="token punctuation">:</span> any <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        mutationKeys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>d <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">(</span>d <span class="token operator">&amp;&amp;</span> d<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>node<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>attr<span class="token punctuation">]</span> <span class="token operator">=</span> d<span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>node<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>attr<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="æ¥ä¸‹æ¥æ˜¯ç¼–è¯‘æ¨¡æ¿"><a href="#æ¥ä¸‹æ¥æ˜¯ç¼–è¯‘æ¨¡æ¿" aria-hidden="true" class="header-anchor">#</a> æ¥ä¸‹æ¥æ˜¯ç¼–è¯‘æ¨¡æ¿</h4> <p><em>è¿™é‡Œåªæ˜¯æ¨¡æ‹Ÿç¼–è¯‘ï¼ŒçœŸæ­£çš„ç¼–è¯‘ä¸æ˜¯è¿™æ ·çš„</em></p> <p>è·å–åˆ°æ¨¡æ¿ä¸Šçš„ v-model ã€ v-bind å±æ€§ï¼Œè·å–åˆ°ç»‘å®šçš„å±æ€§ã€‚å½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ›´æ–°è§†å›¾ï¼ˆè¿™é‡Œä¼šåœ¨triggerè¿›è¡Œè§¦å‘ï¼‰ï¼Œå½“è§†å›¾æ”¹å˜æ•°æ®æ—¶ä¿®æ”¹æ•°æ®ï¼ˆä¸ºäº†ç®€å•ï¼Œé€šè¿‡evalå‡½æ•°å®ç°ï¼‰ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ç¼–è¯‘æ¨¡æ¿</span>
<span class="token keyword">function</span> <span class="token function">_compile</span><span class="token punctuation">(</span><span class="token parameter">nodes<span class="token punctuation">:</span> any<span class="token punctuation">,</span> $data<span class="token punctuation">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token operator">...</span>nodes<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> theNode <span class="token operator">=</span> nodes<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// è·å–åˆ° inputæ ‡ç­¾ä¸‹çš„ v-model å±æ€§ï¼Œå¹¶æ·»åŠ watcher</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>theNode<span class="token punctuation">.</span>tagName <span class="token operator">===</span> <span class="token string">'INPUT'</span> <span class="token operator">&amp;&amp;</span> theNode<span class="token punctuation">.</span><span class="token function">hasAttribute</span><span class="token punctuation">(</span><span class="token string">'v-model'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> key <span class="token operator">=</span> theNode<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'v-model'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Dep<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">_watcher</span><span class="token punctuation">(</span>theNode<span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">,</span> $data<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// ç›‘å¬inputäº‹ä»¶</span>
      theNode<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> mutationKeys <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mutationKeys<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$data.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">='</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>theNode<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        $data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> theNode<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// è·å– v-bind å±æ€§ï¼Œå¹¶æ·»åŠ watcher</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>theNode<span class="token punctuation">.</span><span class="token function">hasAttribute</span><span class="token punctuation">(</span><span class="token string">'v-bind'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> key <span class="token operator">=</span> theNode<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'v-bind'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Dep<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">_watcher</span><span class="token punctuation">(</span>theNode<span class="token punctuation">,</span> <span class="token string">'innerHTML'</span><span class="token punctuation">,</span> $data<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">trigger</span><span class="token punctuation">(</span>$data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>trigger å¯¹ä¾èµ–è¿›è¡Œè§¦å‘</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">trigger</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">:</span> any<span class="token punctuation">,</span> key<span class="token operator">?</span><span class="token punctuation">:</span> string <span class="token operator">|</span> symbol</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Dep<span class="token punctuation">.</span>deps<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">:</span> Watcher</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="ä½¿ç”¨æ•ˆæœ"><a href="#ä½¿ç”¨æ•ˆæœ" aria-hidden="true" class="header-anchor">#</a> ä½¿ç”¨æ•ˆæœ</h4> <h4 id="åºŸè¯ä¸å¤šè¯´ã€‚ç›´æ¥ä¸Šä»£ç ï¼"><a href="#åºŸè¯ä¸å¤šè¯´ã€‚ç›´æ¥ä¸Šä»£ç ï¼" aria-hidden="true" class="header-anchor">#</a> åºŸè¯ä¸å¤šè¯´ã€‚ç›´æ¥ä¸Šä»£ç ï¼</h4> <p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ¨¡æ¿æ˜¯è¿™æ ·çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åœ¨è¿™ä¸ªæ¨¡æ¿çš„ id=&quot;my-app&quot; å…ƒç´ å†…å®ç°åŒå‘ç»‘å®š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;my-app&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>h1 v<span class="token operator">-</span>bind<span class="token operator">=</span><span class="token string">&quot;a&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>input v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">&quot;a&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre></div><p>vue3 ä¸­ new Vue å·²ç»è¢« createApp æ‰€ä»£æ›¿ï¼Œreactive æ˜¯ååº”åŸç†ï¼Œå¯ä»¥æŠ½å‡ºæ¥å•ç‹¬ä½¿ç”¨ï¼Œvue3 å¤–æ¼äº†æ‰€æœ‰å†…éƒ¨çš„ apiï¼Œéƒ½å¯ä»¥åœ¨å¤–éƒ¨ä½¿ç”¨</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> createApp<span class="token punctuation">,</span> reactive <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./vue.ts'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span>
<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> react <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      a<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        b<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          c<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            d<span class="token punctuation">:</span> <span class="token punctuation">{</span>
              e<span class="token punctuation">:</span> <span class="token number">111</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// æµ‹è¯•å¼‚æ­¥ååº”</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      react<span class="token punctuation">.</span>a<span class="token punctuation">.</span>b<span class="token punctuation">.</span>c<span class="token punctuation">.</span>d<span class="token punctuation">.</span>e <span class="token operator">=</span> <span class="token number">222</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> react<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span>App<span class="token punctuation">,</span> <span class="token string">'#my-app'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/xuege-learning/dist/assets/js/app.00484c13.js" defer></script><script src="/xuege-learning/dist/assets/js/2.a1730132.js" defer></script><script src="/xuege-learning/dist/assets/js/8.b97acee4.js" defer></script>
  </body>
</html>
